import { __awaiter } from "tslib";
import { ItemView } from 'obsidian';
import { D20Dice } from './d20-dice';
import { DEFAULT_SETTINGS } from './settings';
export const DICE_VIEW_TYPE = 'dice-view';
export class DiceView extends ItemView {
    constructor(leaf) {
        super(leaf);
        this.dice = null;
        this.diceContainer = null;
        this.resultElement = null;
    }
    getViewType() {
        return DICE_VIEW_TYPE;
    }
    getDisplayText() {
        return 'D20 Dice Roller';
    }
    onOpen() {
        return __awaiter(this, void 0, void 0, function* () {
            const container = this.containerEl.children[1];
            container.empty();
            container.addClass('dice-roller-view');
            const headerEl = container.createEl('div', { cls: 'dice-header' });
            headerEl.createEl('h2', { text: 'ðŸŽ² D20 Dice Roller' });
            // Create main canvas container
            this.diceContainer = container.createEl('div', { cls: 'dice-container-large' });
            // Create overlay controls on top of canvas
            const overlayEl = this.diceContainer.createEl('div', { cls: 'dice-overlay' });
            const controlsEl = overlayEl.createEl('div', { cls: 'dice-controls-overlay' });
            const rollButton = controlsEl.createEl('button', {
                text: 'Roll D20',
                cls: 'mod-cta dice-roll-button'
            });
            this.resultElement = overlayEl.createEl('div', { cls: 'dice-result-overlay' });
            this.dice = new D20Dice(this.diceContainer, DEFAULT_SETTINGS);
            // Set up callback for drag-based rolls
            this.dice.onRollComplete = (result) => {
                this.showResult(result);
            };
            rollButton.addEventListener('click', () => __awaiter(this, void 0, void 0, function* () {
                rollButton.disabled = true;
                rollButton.textContent = 'Rolling...';
                this.resultElement.textContent = '';
                this.resultElement.className = 'dice-result';
                try {
                    const result = yield this.dice.roll();
                    this.showResult(result);
                }
                catch (error) {
                    this.resultElement.textContent = 'Error rolling dice';
                    this.resultElement.className = 'dice-result error';
                }
                finally {
                    rollButton.disabled = false;
                    rollButton.textContent = 'Roll D20';
                }
            }));
        });
    }
    showResult(result) {
        const copyableText = typeof result === 'string' ? result : `1d20=${result}`;
        this.resultElement.textContent = copyableText;
        this.resultElement.className = 'dice-result show';
        this.resultElement.title = 'Click to copy result';
        this.resultElement.style.cursor = 'pointer';
        // Make result clickable to copy
        this.resultElement.onclick = () => {
            navigator.clipboard.writeText(copyableText).then(() => {
                const originalText = this.resultElement.textContent;
                this.resultElement.textContent = 'Copied!';
                setTimeout(() => {
                    this.resultElement.textContent = originalText;
                }, 1000);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = copyableText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                const originalText = this.resultElement.textContent;
                this.resultElement.textContent = 'Copied!';
                setTimeout(() => {
                    this.resultElement.textContent = originalText;
                }, 1000);
            });
        };
    }
    onClose() {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.dice) {
                this.dice.destroy();
                this.dice = null;
            }
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGljZS12aWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGljZS12aWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFpQixNQUFNLFVBQVUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3JDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUU5QyxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsV0FBVyxDQUFDO0FBRTFDLE1BQU0sT0FBTyxRQUFTLFNBQVEsUUFBUTtJQUtsQyxZQUFZLElBQW1CO1FBQzNCLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUxSLFNBQUksR0FBbUIsSUFBSSxDQUFDO1FBQzVCLGtCQUFhLEdBQXVCLElBQUksQ0FBQztRQUN6QyxrQkFBYSxHQUF1QixJQUFJLENBQUM7SUFJakQsQ0FBQztJQUVELFdBQVc7UUFDUCxPQUFPLGNBQWMsQ0FBQztJQUMxQixDQUFDO0lBRUQsY0FBYztRQUNWLE9BQU8saUJBQWlCLENBQUM7SUFDN0IsQ0FBQztJQUVLLE1BQU07O1lBQ1IsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2xCLFNBQVMsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUV2QyxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxhQUFhLEVBQUUsQ0FBQyxDQUFDO1lBQ25FLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFFLENBQUMsQ0FBQztZQUV4RCwrQkFBK0I7WUFDL0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssRUFB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RUFBRTtvQkFDWixJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsR0FBRyxZQUFZLENBQUM7Z0JBQ2xELENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNiLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUU7Z0JBQ1YsOEJBQThCO2dCQUM5QixNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUNwRCxRQUFRLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQztnQkFDOUIsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3BDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDbEIsUUFBUSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDN0IsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBRXBDLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDO2dCQUNwRCxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUM7Z0JBQzNDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7b0JBQ1osSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLEdBQUcsWUFBWSxDQUFDO2dCQUNsRCxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDYixDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQztJQUNOLENBQUM7SUFFSyxPQUFPOztZQUNULElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDWCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUNwQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQzthQUNwQjtRQUNMLENBQUM7S0FBQTtDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSXRlbVZpZXcsIFdvcmtzcGFjZUxlYWYgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBEMjBEaWNlIH0gZnJvbSAnLi9kMjAtZGljZSc7XG5pbXBvcnQgeyBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSAnLi9zZXR0aW5ncyc7XG5cbmV4cG9ydCBjb25zdCBESUNFX1ZJRVdfVFlQRSA9ICdkaWNlLXZpZXcnO1xuXG5leHBvcnQgY2xhc3MgRGljZVZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XG4gICAgcHJpdmF0ZSBkaWNlOiBEMjBEaWNlIHwgbnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSBkaWNlQ29udGFpbmVyOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICAgIHByaXZhdGUgcmVzdWx0RWxlbWVudDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICAgIGNvbnN0cnVjdG9yKGxlYWY6IFdvcmtzcGFjZUxlYWYpIHtcbiAgICAgICAgc3VwZXIobGVhZik7XG4gICAgfVxuXG4gICAgZ2V0Vmlld1R5cGUoKSB7XG4gICAgICAgIHJldHVybiBESUNFX1ZJRVdfVFlQRTtcbiAgICB9XG5cbiAgICBnZXREaXNwbGF5VGV4dCgpIHtcbiAgICAgICAgcmV0dXJuICdEMjAgRGljZSBSb2xsZXInO1xuICAgIH1cblxuICAgIGFzeW5jIG9uT3BlbigpIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jb250YWluZXJFbC5jaGlsZHJlblsxXTtcbiAgICAgICAgY29udGFpbmVyLmVtcHR5KCk7XG4gICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcygnZGljZS1yb2xsZXItdmlldycpO1xuXG4gICAgICAgIGNvbnN0IGhlYWRlckVsID0gY29udGFpbmVyLmNyZWF0ZUVsKCdkaXYnLCB7IGNsczogJ2RpY2UtaGVhZGVyJyB9KTtcbiAgICAgICAgaGVhZGVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAn8J+OsiBEMjAgRGljZSBSb2xsZXInIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBtYWluIGNhbnZhcyBjb250YWluZXJcbiAgICAgICAgdGhpcy5kaWNlQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZUVsKCdkaXYnLCB7IGNsczogJ2RpY2UtY29udGFpbmVyLWxhcmdlJyB9KTtcblxuICAgICAgICAvLyBDcmVhdGUgb3ZlcmxheSBjb250cm9scyBvbiB0b3Agb2YgY2FudmFzXG4gICAgICAgIGNvbnN0IG92ZXJsYXlFbCA9IHRoaXMuZGljZUNvbnRhaW5lci5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICdkaWNlLW92ZXJsYXknIH0pO1xuXG4gICAgICAgIGNvbnN0IGNvbnRyb2xzRWwgPSBvdmVybGF5RWwuY3JlYXRlRWwoJ2RpdicsIHsgY2xzOiAnZGljZS1jb250cm9scy1vdmVybGF5JyB9KTtcbiAgICAgICAgY29uc3Qgcm9sbEJ1dHRvbiA9IGNvbnRyb2xzRWwuY3JlYXRlRWwoJ2J1dHRvbicsIHtcbiAgICAgICAgICAgIHRleHQ6ICdSb2xsIEQyMCcsXG4gICAgICAgICAgICBjbHM6ICdtb2QtY3RhIGRpY2Utcm9sbC1idXR0b24nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucmVzdWx0RWxlbWVudCA9IG92ZXJsYXlFbC5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICdkaWNlLXJlc3VsdC1vdmVybGF5JyB9KTtcblxuICAgICAgICB0aGlzLmRpY2UgPSBuZXcgRDIwRGljZSh0aGlzLmRpY2VDb250YWluZXIsIERFRkFVTFRfU0VUVElOR1MpO1xuXG4gICAgICAgIC8vIFNldCB1cCBjYWxsYmFjayBmb3IgZHJhZy1iYXNlZCByb2xsc1xuICAgICAgICB0aGlzLmRpY2Uub25Sb2xsQ29tcGxldGUgPSAocmVzdWx0OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1Jlc3VsdChyZXN1bHQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJvbGxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICByb2xsQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJvbGxCdXR0b24udGV4dENvbnRlbnQgPSAnUm9sbGluZy4uLic7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdEVsZW1lbnQudGV4dENvbnRlbnQgPSAnJztcbiAgICAgICAgICAgIHRoaXMucmVzdWx0RWxlbWVudC5jbGFzc05hbWUgPSAnZGljZS1yZXN1bHQnO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGljZSEucm9sbCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd1Jlc3VsdChyZXN1bHQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdEVsZW1lbnQudGV4dENvbnRlbnQgPSAnRXJyb3Igcm9sbGluZyBkaWNlJztcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdEVsZW1lbnQuY2xhc3NOYW1lID0gJ2RpY2UtcmVzdWx0IGVycm9yJztcbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgcm9sbEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJvbGxCdXR0b24udGV4dENvbnRlbnQgPSAnUm9sbCBEMjAnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNob3dSZXN1bHQocmVzdWx0OiBudW1iZXIgfCBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgY29weWFibGVUZXh0ID0gdHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycgPyByZXN1bHQgOiBgMWQyMD0ke3Jlc3VsdH1gO1xuICAgICAgICB0aGlzLnJlc3VsdEVsZW1lbnQudGV4dENvbnRlbnQgPSBjb3B5YWJsZVRleHQ7XG4gICAgICAgIHRoaXMucmVzdWx0RWxlbWVudC5jbGFzc05hbWUgPSAnZGljZS1yZXN1bHQgc2hvdyc7XG4gICAgICAgIHRoaXMucmVzdWx0RWxlbWVudC50aXRsZSA9ICdDbGljayB0byBjb3B5IHJlc3VsdCc7XG4gICAgICAgIHRoaXMucmVzdWx0RWxlbWVudC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7XG5cbiAgICAgICAgLy8gTWFrZSByZXN1bHQgY2xpY2thYmxlIHRvIGNvcHlcbiAgICAgICAgdGhpcy5yZXN1bHRFbGVtZW50Lm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChjb3B5YWJsZVRleHQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IHRoaXMucmVzdWx0RWxlbWVudC50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdEVsZW1lbnQudGV4dENvbnRlbnQgPSAnQ29waWVkISc7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0RWxlbWVudC50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dDtcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayBmb3Igb2xkZXIgYnJvd3NlcnNcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0QXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XG4gICAgICAgICAgICAgICAgdGV4dEFyZWEudmFsdWUgPSBjb3B5YWJsZVRleHQ7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXh0QXJlYSk7XG4gICAgICAgICAgICAgICAgdGV4dEFyZWEuc2VsZWN0KCk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRleHRBcmVhKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IHRoaXMucmVzdWx0RWxlbWVudC50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdEVsZW1lbnQudGV4dENvbnRlbnQgPSAnQ29waWVkISc7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0RWxlbWVudC50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dDtcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFzeW5jIG9uQ2xvc2UoKSB7XG4gICAgICAgIGlmICh0aGlzLmRpY2UpIHtcbiAgICAgICAgICAgIHRoaXMuZGljZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmRpY2UgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxufSJdfQ==